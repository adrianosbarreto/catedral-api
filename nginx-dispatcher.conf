# CONFIGURAÇÃO NGINX CORRIGIDA - Content-Type Fix

# Esta configuração garante que todos os headers sejam passados corretamente

location /catedral {
    # Proxy para o Flask
    proxy_pass http://127.0.0.1:5000;
    
    # Headers essenciais - ORDEM IMPORTA!
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # CRÍTICO: Passar Content-Type do cliente
    proxy_set_header Content-Type $content_type;
    
    # CRÍTICO: Não alterar o body
    proxy_pass_request_body on;
    proxy_pass_request_headers on;
    
    # Timeouts
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
    
    # Buffering (deixar off para debugging)
    proxy_buffering off;
}

# ============================================================
# APLICAR:
# ============================================================
# 1. Adicione este bloco ao seu nginx
# 2. sudo nginx -t
# 3. sudo systemctl reload nginx
# 4. Teste novamente o login
